# Update typically used packages

function update() {
	local START_TIME=$(date +%s)
	wait-for-internet --text "(waiting for internet)"
	echo "Updating system (pacman/yay/brew) packages..."
	if [[ -z "$ONLINUX" ]]; then
		brew update && brew upgrade
		brew cask upgrade
		# run brew cask upgrade --greedy once per month
		evry 1 month -brewgreedy && brew cask upgrade --greedy
	else
		yay -Syu
		housekeeping
	fi
	yadm bootstrap
	echo "Updating nvim packages..."
	nvim +PlugUpdate +qall
	echo "Updating doom emacs..."
	doom -y upgrade
	echo "Updating ruby packages..."
	gem update
	echo "Updating python packages..."
	pip install -U -r "${XDG_CONFIG_HOME}/yadm/package_lists/python3_packages.txt"
	update-python-packages
	echo "Updating global npm packages..."
	npm update -g
	echo "Updating global cargo packages..."
	cargo install-update -a
	echo "Updating global go packages..."
	cd
	go get -u -v $(cut -d" " -f2 "$HOME/.config/yadm/package_lists/go_packages.txt") 2>&1 | grep "(download)$"
	cd "$OLDPWD"
	printf "Finished updates in %d seconds\n" $(bc <<<"$(date +%s) - ${START_TIME}") | boxes -dshell -pv1h2
}
