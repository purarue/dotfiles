#!/usr/bin/env bash

set -e # exit on non zero return code
set -u # undefined variables are errors

readonly usage="Usage: $(basename "$0") [OPTION] FILE...
Opens an editor. If no options are provided,
opens the file(s) with nvim

Options:

  -h                 Print this message and exit
  -e                 Opens with emacs
  -c                 Opens the emacs client
"

# define enum
readonly EMACS=0
readonly EMACS_CLIENT=1
readonly NVIM=2

# default action
declare ACTION=$NVIM

while getopts "hec" OPT; do
	case "$OPT" in
	h)
		printf "%s" "$usage"
		exit 0
		;;
	e)
		ACTION="$EMACS"
		;;
	c)
		ACTION="$EMACS_CLIENT"
		;;
	?)
		printf "%s" "$usage"
		exit 1
		;;
	esac
done
shift "$((OPTIND - 1))"

# perform action
case "$ACTION" in
"$NVIM")
	if (($# == 0)); then
		nvim +Explore
	else
		nvim "$@"
	fi
	;;
"$EMACS")
	if [ -n "$ONLINUX" ]; then
		setsid emacs "$@" &
	else
		emacs "$@" # alacritty can handle this in terminal
	fi
	;;
"$EMACS_CLIENT")
	if [ -n "$ONLINUX" ]; then
		setsid emacsclient -c "$@" &
	else
		emacs "$@" # dont use emacsclient on mac
	fi
	;;
esac
