#!/bin/bash
# A script for unrelated tasks I want to run every so often
# Uses my 'evry' tool to handle how often to run tasks:
# https://github.com/seanbreckenridge/evry

wait-for-internet --text "Running 'housekeeping'..."

# make sure commands exist
export HAVECMD_REPORT=1

declare -a required_binaries
required_binaries=(evry backup_server pythonanywhere_3_months)
for binary in "${required_binaries[@]}"; do
	havecmd "$binary" || exit $?
done

evry 1 day -backup_fish_server && backup_server
evry 2 months -pythonanywhere && pythonanywhere_3_months -Hc "$(which chromedriver)"

# has the possibility to fail, if I'm not home and it tries to
# find the raspberry pi on my home network
evry 3 days -raspibackupdelete && {
  # if this fails, rollback and try next time I run update
  "${REPOS}"/raspi-backup/backup -d || evry rollback -raspibackupdelete
}
