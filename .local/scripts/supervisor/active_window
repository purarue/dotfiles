#!/usr/bin/env bash
# uses arbtt on linux: https://github.com/nomeata/arbtt#arbtt-the-automatic-rule-based-time-tracker
# uses my window watcher fork on mac https://github.com/seanbreckenridge/aw-watcher-window
set -e
set -x

timestamp_filename() {
	local ext prefix
	ext="${1:?must provide either csv or log, signifying window_watcher or arbtt}"
	prefix="${HOME}/data"
	case "${ext}" in
	csv)
		prefix="${prefix}/window_watcher"
		;;
	log)
		prefix="${prefix}/arbtt"
		;;
	esac
	if [[ ! -d "${prefix}" ]]; then
		mkdir -p "${prefix}"
	fi
	printf '%s/%s_%s.%s' "${prefix}" "$(date '+%s')" "$(uname -n)" "${ext}"
}

if havecmd arbtt-capture; then
	exec arbtt-capture -f "$(timestamp_filename log)" -r 30
else
	exec window_watcher -d "$(timestamp_filename csv)" -p 30
fi
