#!/bin/bash -ex
# thyme doesnt work on my mac (https://github.com/sourcegraph/thyme/issues/32),
# so this uses my window watcher fork on mac https://github.com/seanbreckenridge/aw-watcher-window
# and thyme on linux (https://github.com/sourcegraph/thyme)

cd "$(realpath "$(dirname "${BASH_SOURCE[0]}")")"

if [[ "$(uname -s)" == "Linux" ]]; then
  exec ./thyme_loop
else
  declare -a WINDOW_WATCHER_ARGS
  WINDOW_WATCHER_ARGS=()
  # just save to my data directory instead of ~/.local/share/window_watcher
  if [[ -d "${HOME}/data/window_watcher/" ]]; then
    WINDOW_WATCHER_ARGS+=(--datafile "${HOME}/data/window_watcher/$(date "+%s")")
  fi
  exec window_watcher "${WINDOW_WATCHER_ARGS[@]}"
fi
