#!/usr/bin/env sh
#
# Opens the $BROWSER, if its not already open
# Used to detach browser processes so that other
# applications that interact with the browser
# (e.g. xdg-open or pythons webbrowser module)
# dont own the browser process and kill the browser
# when the script is eventually Ctrl+C'd

if [ -z "$BROWSER" ]; then
  echo "Error: No \$BROWSER environment variable set\! Set it to your browser"
  exit 1
fi

# count the number of browser processes
# this is often more than one, depending on the number of tabs
BROWSER_PROC_COUNT="$(ps -aux | grep "$BROWSER" | grep -v "grep $BROWSER" | wc -l)"

[ "$BROWSER_PROC_COUNT" -eq 0 ] && "$BROWSER" &

